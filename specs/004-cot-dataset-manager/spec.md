# Feature Specification: CoT 데이터셋 관리 웹앱

**Feature Branch**: `004-cot-dataset-manager`  
**Created**: 2025-10-17  
**Status**: Draft  
**Input**: User description: "현재 프로젝트의 내용을 바탕으로 작성해보자."

## Clarifications

### Session 2025-10-17

- Q: 질문, CoT1~n, 답변 필드의 최대 허용 길이는? → A: 질문 1000자, CoT 5000자, 답변 8000자
- Q: CoT/질문자/상품 삭제는 영구 삭제인가, 복구 가능한 소프트 삭제인가? → A: 영구 삭제 (hard delete)
- Q: 동일한 CoT를 여러 탭/창에서 동시에 편집하면 어떻게 처리하나? → A: 마지막 저장 우선 (last write wins)

## User Scenarios & Testing *(mandatory)*

### User Story 1 - CoT 데이터 생성 및 관리 (Priority: P1)

관리자는 CoT(Chain of Thought) 질의응답 데이터를 생성하고 관리한다. 3패널 레이아웃을 통해 질문자를 선택하고, 금융상품을 선택하며, 중앙 패널에서 질문과 사고 과정(CoT1~CoTn)을 단계별로 작성하여 최종 답변을 완성한다.

**Why this priority**: LLM 학습용 데이터셋 생성이 프로젝트의 핵심 목적이며, 이 기능 없이는 시스템의 존재 이유가 없다.

**Independent Test**: CoT 생성 화면을 열어 질문자 1명과 상품 1개를 선택하고, 질문/CoT1~3/답변을 입력하여 저장한 후, 저장된 CoT를 목록에서 확인하고 다시 열어 수정할 수 있다.

**Acceptance Scenarios**:

1. **Given** 관리자가 CoT 생성 화면에 진입, **When** 좌측 패널에서 질문자를 검색하여 1명을 선택, **Then** 선택한 질문자의 상세 정보(성별, 연령대, 투자성향 등)가 패널에 표시된다
2. **Given** 질문자가 선택됨, **When** 우측 패널에서 금융상품을 검색하여 복수 선택, **Then** 선택한 상품 목록이 아코디언 형태로 표시되며 각 상품의 상세 정보를 확인할 수 있다
3. **Given** 질문자와 상품이 선택됨, **When** 중앙 패널에서 상품분류와 질문유형을 선택하고 질문/CoT1~3/답변을 입력 후 저장, **Then** 유효성 검사를 통과하면 데이터가 저장되고 CoT 목록으로 이동한다
4. **Given** CoT 목록 화면, **When** 저장된 CoT 항목을 클릭, **Then** 3패널 레이아웃에서 해당 CoT의 모든 정보가 로드되어 표시된다
5. **Given** CoT 상세 화면, **When** 내용을 수정하고 저장, **Then** 수정일이 업데이트되며 변경사항이 반영된다
6. **Given** CoT 상세 화면, **When** CoT 단계 추가 버튼을 클릭, **Then** CoT4, CoT5 등 추가 단계가 동적으로 생성되어 입력할 수 있다
7. **Given** CoT 상세 화면, **When** 삭제 버튼 클릭 후 확인 팝업에서 확인 선택, **Then** 해당 CoT가 삭제되고 목록으로 돌아간다

---

### User Story 2 - 데이터 Import 및 Export (Priority: P2)

관리자는 질문자, 상품, CoT 데이터를 CSV, JSON, XLSX 형식으로 가져오거나 내보낼 수 있다. Import 시 데이터 미리보기와 유효성 검사 결과를 확인하고, Export 시 현재 필터링된 데이터만 선택적으로 내보낼 수 있다.

**Why this priority**: 대용량 데이터(질문자 30만, 상품 1만, CoT 1만)를 효율적으로 관리하기 위해서는 배치 Import/Export가 필수적이다.

**Independent Test**: 샘플 CSV 파일을 Import하여 데이터가 로드되는지 확인하고, 로드된 데이터를 다시 Export하여 원본과 일치하는지 검증한다.

**Acceptance Scenarios**:

1. **Given** 질문자 목록 화면, **When** Import 버튼을 클릭하고 CSV 파일을 선택, **Then** 파일 내용을 파싱하여 미리보기와 유효성 검사 결과(성공 건수, 오류 목록)를 표시한다
2. **Given** Import 미리보기 화면, **When** Import 실행 버튼을 클릭, **Then** 유효한 데이터는 저장되고 오류가 있는 행은 건너뛰며 상세 리포트를 표시한다
3. **Given** 상품 목록 화면에서 검색 조건 적용, **When** Export 버튼을 클릭하고 JSON 형식을 선택, **Then** 현재 표시된 데이터만 JSON 파일로 다운로드된다
4. **Given** CoT 목록 화면, **When** XLSX 파일을 Import, **Then** 파일 형식을 자동으로 인식하고 데이터를 올바르게 파싱하여 로드한다
5. **Given** Import 진행 중, **When** 대용량 파일(1만 건 이상) 처리, **Then** 진행률 표시와 함께 배치 처리(1000건 단위)로 메모리 사용량을 제한하며 처리한다

---

### User Story 3 - 질문자 및 상품 데이터 조회 (Priority: P3)

관리자는 질문자와 상품 데이터를 조회하고 검색하여 CoT 생성 시 참조한다. 질문자는 성별, 연령대, 고객출처로 필터링할 수 있고, 상품은 상품분류와 위험등급으로 필터링할 수 있다.

**Why this priority**: CoT 생성을 위한 참조 데이터 관리 기능이지만, CoT 생성 자체보다는 부차적인 역할이다.

**Independent Test**: 질문자 목록에서 필터를 적용하여 특정 조건의 질문자만 표시하고, 항목을 클릭하여 상세 정보를 확인할 수 있다.

**Acceptance Scenarios**:

1. **Given** 질문자 목록 화면, **When** 성별 "여", 연령대 "30대" 필터를 적용, **Then** 해당 조건에 맞는 질문자만 목록에 표시된다
2. **Given** 필터링된 질문자 목록, **When** 질문자 항목을 클릭, **Then** 성별, 연령대, 투자성향, 보유상품 등 상세 정보가 표시된다
3. **Given** 상품 목록 화면, **When** 상품분류 "증권", 위험등급 "공격투자형" 필터를 적용, **Then** 해당 조건에 맞는 상품만 표시되며 각 상품의 이름과 카테고리가 표시된다
4. **Given** 상품 목록 화면, **When** 검색창에 상품명 키워드를 입력, **Then** 실시간으로 검색 결과가 필터링되어 표시된다
5. **Given** 질문자/상품 목록 화면, **When** 컬럼 헤더를 클릭, **Then** 해당 컬럼 기준으로 오름차순/내림차순 정렬된다

---

### User Story 4 - 검색 및 고급 필터링 (Priority: P4)

관리자는 CoT 목록에서 전체 텍스트 검색과 고급 필터를 사용하여 원하는 데이터를 빠르게 찾는다. 검색은 질문, CoT1~n, 답변 본문을 대상으로 하며, 필터는 상품분류, 질문유형, 상태 등을 조합할 수 있다.

**Why this priority**: 데이터 검색은 생산성을 높이는 편의 기능이지만 핵심 기능은 아니다.

**Independent Test**: CoT 목록에서 키워드를 검색하여 관련 항목만 표시하고, 여러 필터를 조합하여 정확한 데이터를 찾을 수 있다.

**Acceptance Scenarios**:

1. **Given** CoT 목록 화면, **When** 검색창에 "펀드"를 입력, **Then** 질문, CoT1~n, 답변 중 "펀드"를 포함하는 모든 CoT가 실시간으로 표시된다
2. **Given** 검색 결과 표시 중, **When** 상품분류 "증권" 필터를 추가 적용, **Then** "펀드"를 포함하면서 상품분류가 "증권"인 CoT만 표시된다
3. **Given** CoT 목록 화면, **When** 상태 "완료" 필터를 적용, **Then** 완료 상태의 CoT만 표시되며 개수가 표시된다
4. **Given** 필터링된 목록, **When** 페이지 크기를 25에서 100으로 변경, **Then** 한 페이지에 100개 항목이 표시되며 가상 스크롤이 적용된다

---

### User Story 5 - 설정 및 UI 커스터마이징 (Priority: P5)

관리자는 설정 화면에서 기본 작성자 이름, 글꼴 크기, 다크/라이트 모드, 수정 권한 등을 조정하고, 이러한 설정은 자동으로 로컬 스토리지에 저장되어 다음 접속 시에도 유지된다.

**Why this priority**: 사용자 경험을 개선하는 기능이지만 핵심 데이터 관리 기능과는 독립적이다.

**Independent Test**: 설정 화면에서 다크 모드를 활성화하고 글꼴 크기를 조정한 후, 브라우저를 닫았다 다시 열어도 설정이 유지되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 설정 화면, **When** 다크 모드 토글을 활성화, **Then** 즉시 전체 UI가 다크 모드로 전환되고 설정이 로컬 스토리지에 저장된다
2. **Given** 설정 화면, **When** 글꼴 크기 슬라이더를 10px에서 18px로 조정, **Then** 모든 텍스트의 크기가 실시간으로 변경되고 설정이 저장된다
3. **Given** 설정을 변경한 후, **When** 브라우저를 닫고 다시 앱을 실행, **Then** 이전에 설정한 다크 모드와 글꼴 크기가 그대로 적용되어 있다
4. **Given** 설정 화면, **When** 기본 작성자 이름을 "관리자"에서 "김철수"로 변경, **Then** 새로 생성하는 CoT의 작성자 필드에 "김철수"가 자동으로 입력된다
5. **Given** CoT 생성 화면, **When** 패널 경계선을 드래그하여 좌측 패널 너비를 조정, **Then** 변경된 패널 크기가 저장되어 다음 접속 시에도 유지된다

---

### User Story 6 - 반응형 UI 및 접근성 (Priority: P6)

관리자는 키보드만으로 모든 기능에 접근할 수 있고, 스크린 리더와 호환되며, 고대비 모드를 지원하는 접근 가능한 인터페이스를 사용한다.

**Why this priority**: 접근성은 중요하지만 기본 기능이 동작한 후에 개선할 수 있는 영역이다.

**Independent Test**: 마우스 없이 Tab, Enter, 화살표 키만으로 CoT를 생성하고 저장할 수 있는지 확인한다.

**Acceptance Scenarios**:

1. **Given** CoT 생성 화면, **When** Tab 키로 폼 필드를 순회, **Then** 논리적인 순서로 포커스가 이동하고 포커스 인디케이터가 명확히 표시된다
2. **Given** 드롭다운 메뉴, **When** Enter 키로 열고 화살표 키로 선택, **Then** 마우스 없이 옵션을 선택할 수 있다
3. **Given** 스크린 리더 실행 중, **When** CoT 폼을 탐색, **Then** 각 필드의 레이블과 역할이 음성으로 읽혀진다
4. **Given** 다크 모드 활성화, **When** 텍스트와 배경색 확인, **Then** WCAG 2.1 AA 명암비 기준(4.5:1)을 충족한다

---

### Edge Cases

- 필수 필드(질문자, 상품, 질문, CoT1~3, 답변) 미입력 시 저장 시도: 저장이 차단되고 누락된 필드에 빨간색 테두리와 오류 메시지가 표시된다
- 텍스트 필드 길이 초과: 질문(1000자), CoT 단계(5000자), 답변(8000자) 초과 시 입력이 차단되고 남은 글자 수가 표시된다
- 대용량 데이터 동시 검색/정렬/페이징: 가상 스크롤과 디바운싱(300ms)을 적용하여 p95 응답 시간 300ms 이내를 유지한다 (SC-003)
- Import 파일의 필드 누락/타입 불일치: 해당 행은 건너뛰고 상세 오류 리포트(행 번호, 오류 내용)를 제공한다
- Import 파일의 중복 ID: 최신 데이터로 덮어쓰기 또는 건너뛰기 정책을 선택할 수 있는 옵션을 제공한다
- 삭제 확인 팝업에서 취소 선택: 아무 변경 없이 이전 상태로 돌아간다
- 삭제 확인 후 실행: 데이터가 영구적으로 삭제되며 복구할 수 없다 (사용자에게 명확히 경고 표시)
- 동일 데이터를 여러 탭/창에서 동시 편집: 마지막에 저장한 변경사항이 적용되며, 이전 탭의 변경사항은 덮어써진다
- 네트워크 연결 없는 환경: 모든 기능이 정상적으로 동작한다(오프라인 우선 설계)
- 브라우저 스토리지 용량 초과: 데이터 저장 실패 시 명확한 오류 메시지와 Export 권장 안내를 표시한다

## Requirements *(mandatory)*

### Functional Requirements

#### 데이터 관리
- **FR-001**: 시스템은 질문자, 금융상품, CoT 질의응답 데이터를 로컬 브라우저 스토리지(IndexedDB)에 저장해야 한다
- **FR-002**: 시스템은 질문자 30만 건, 상품 1만 건, CoT 1만 건을 저장하고 조회할 수 있어야 한다
- **FR-003**: 시스템은 CoT 데이터 생성 시 질문자 1명과 상품 1개 이상을 필수로 선택해야 한다
- **FR-004**: 시스템은 CoT1, CoT2, CoT3 단계를 필수로 입력받고, CoT4 이후는 선택적으로 추가할 수 있어야 한다

#### 사용자 인터페이스
- **FR-005**: 시스템은 CoT 생성/수정 시 3패널 레이아웃(질문자 선택 | CoT 폼 | 상품 선택)을 제공해야 한다
- **FR-006**: 시스템은 각 패널의 너비를 드래그로 조절할 수 있어야 하며, 조절된 크기는 자동으로 저장되어야 한다
- **FR-007**: 시스템은 텍스트 입력 영역(질문, CoT, 답변)의 높이를 개별적으로 조절할 수 있어야 하며, 조절된 높이는 저장되어야 한다
- **FR-008**: 시스템은 질문자 선택 시 팝업 레이어에서 성별, 연령대 필터로 검색할 수 있어야 한다
- **FR-009**: 시스템은 상품 선택 시 복수 선택을 지원하고, 선택된 상품을 아코디언 형태로 표시해야 한다

#### 검색 및 필터링
- **FR-010**: 시스템은 CoT 목록에서 질문, CoT1~n, 답변 본문을 대상으로 전체 텍스트 검색을 제공해야 한다
- **FR-011**: 시스템은 상품분류, 질문유형, 성별, 연령대, 상태 기준으로 필터링을 제공해야 한다
- **FR-012**: 시스템은 각 컬럼 헤더를 클릭하여 오름차순/내림차순 정렬을 제공해야 한다
- **FR-013**: 시스템은 페이지 크기를 25/50/100으로 조정할 수 있어야 하며, 가상 스크롤을 적용해야 한다

#### Import/Export
- **FR-014**: 시스템은 CSV, JSON, XLSX 형식의 파일 Import를 지원해야 한다
- **FR-015**: 시스템은 Import 전 데이터 미리보기와 유효성 검사 결과를 표시해야 한다
- **FR-016**: 시스템은 유효하지 않은 데이터 행을 건너뛰고 상세 오류 리포트(행 번호, 오류 내용)를 제공해야 한다
- **FR-017**: 시스템은 대용량 파일 Import 시 배치 처리(1000건 단위)와 진행률 표시를 제공해야 한다
- **FR-018**: 시스템은 현재 표시된 데이터만 선택적으로 Export할 수 있어야 한다
- **FR-019**: 시스템은 CSV Export 시 UTF-8과 EUC-KR 인코딩을 선택할 수 있어야 한다

#### 유효성 검사
- **FR-020**: 시스템은 필수 필드(상품분류, 질문유형, 질문자, 상품 리스트, 질문, CoT1~3, 답변, 상태) 미입력 시 저장을 차단해야 한다
- **FR-021**: 시스템은 유효성 검사 실패 시 필드별 오류 메시지를 표시해야 한다
- **FR-022**: 시스템은 사전정의된 값(상품분류, 질문유형, 성별, 연령대)만 허용해야 한다
- **FR-023**: 시스템은 질문유형이 상품분류에 종속되도록 드롭다운 옵션을 동적으로 필터링해야 한다
- **FR-024**: 시스템은 텍스트 필드 길이를 제한해야 한다: 질문(최대 1000자), CoT 단계(최대 5000자), 답변(최대 8000자)

#### 설정 관리
- **FR-025**: 시스템은 기본 작성자 이름, 글꼴 크기(10~24px), 다크/라이트 모드, 수정 권한을 설정할 수 있어야 한다
- **FR-026**: 시스템은 모든 설정을 로컬 스토리지에 자동 저장하고 다음 접속 시 복원해야 한다
- **FR-027**: 시스템은 다크 모드 전환 시 전체 UI가 1초 이내에 반영되어야 한다 (SC-006: <1초)

#### 접근성
- **FR-028**: 시스템은 키보드만으로 모든 기능에 접근할 수 있어야 한다
- **FR-029**: 시스템은 WCAG 2.1 AA 명암비 기준(4.5:1)을 충족해야 한다
- **FR-030**: 시스템은 포커스 인디케이터를 명확히 표시해야 한다
- **FR-031**: 시스템은 스크린 리더와 호환되도록 ARIA 레이블과 역할을 제공해야 한다

#### 데이터 무결성
- **FR-032**: 시스템은 등록일과 수정일을 자동으로 관리해야 한다
- **FR-033**: 시스템은 삭제 작업 전 확인 팝업을 표시해야 하며, 삭제는 영구적이고 복구 불가능함을 명확히 경고해야 한다
- **FR-034**: 시스템은 CoT ID의 고유성을 보장하고 중복 시 저장을 차단해야 한다
- **FR-035**: 시스템은 동시 편집 시 마지막 저장 우선(last write wins) 정책을 적용해야 한다

### Key Entities

- **질문자(UserAnon)**: 익명화된 금융 고객 정보. 고객출처(증권/보험), 성별, 연령대, 투자성향(증권 시), 보험가입교차비율(보험 시), 투자액, 보유상품 리스트를 포함한다. 개인 식별 정보는 포함하지 않는다.

- **금융상품(Product)**: 추천 대상 금융상품 정보. 상품출처(증권/보험), 상품명, 상품분류(출처별 카테고리), 세금유형, 위험등급, 상품설명, 운용사, 설정수익률을 포함한다.

- **CoT 질의응답(CoTQA)**: LLM 학습용 Chain of Thought 데이터. CoT ID, 상품분류, 질문유형, 질문자 참조(1명), 금융상품 참조(1개 이상), 질문, CoT1~CoTn(사고 단계), 답변, 데이터셋 상태(초안/검토중/완료/보류), 작성자, 등록일, 수정일을 포함한다.

- **설정(Settings)**: 사용자별 UI 설정. 기본 작성자 이름, 글꼴 크기(px), 테마(라이트/다크), 질문자 수정가능 여부, 상품 수정가능 여부, 패널 크기, 텍스트 영역 높이를 포함한다.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 관리자는 새로운 CoT 데이터를 5분 이내에 생성하고 저장할 수 있다
- **SC-002**: 시스템은 질문자 30만 건, 상품 1만 건, CoT 1만 건을 저장하고 조회할 수 있다
- **SC-003**: 리스트 화면의 검색/정렬/페이징 상호작용은 300ms 이내에 응답한다(p95 기준)
- **SC-004**: Import 기능으로 1만 건의 데이터를 10분 이내에 처리할 수 있다
- **SC-005**: 모든 기능은 네트워크 연결 없이 정상 동작한다
- **SC-006**: 다크 모드와 글꼴 크기 변경은 1초 이내에 전체 UI에 반영된다
- **SC-007**: 키보드만으로 CoT 생성부터 저장까지 전 과정을 완료할 수 있다
- **SC-008**: 브라우저 메모리 사용량은 500MB 이하를 유지한다
- **SC-009**: 관리자의 90%가 첫 사용 시 도움말 없이 CoT를 생성할 수 있다
- **SC-010**: 데이터 Import 시 99% 이상의 유효한 데이터가 성공적으로 저장된다
